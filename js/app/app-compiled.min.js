(function(){Ember.Notify=Ember.ArrayProxy.extend({content:Ember.A(),timeout:5e3,pushObject:function(e){e.typeClass="alert-"+e.type,this._super(e)},danger:function(e){this.pushObject({type:"danger",message:e})},warning:function(e){this.pushObject({type:"warning",message:e})},info:function(e){this.pushObject({type:"info",message:e})},success:function(e){this.pushObject({type:"success",message:e})}}),Ember.Application.initializer({name:"registerNotifyMessages",initialize:function(e,t){t.register("notify:main",Ember.Notify)}}),Ember.Application.initializer({name:"injectNotifyMessages",initialize:function(e,t){t.inject("controller","notify","notify:main"),t.inject("component","notify","notify:main"),t.inject("route","notify","notify:main")}})}).call(this),function(){Ember.Utility=Ember.Object.extend({idFromURL:function(e){var t,n;return t=/([a-f0-9]{24})/,n=t.exec(e)||["",null],null!=n&&(n=t.exec(App.__container__.lookup("router:main").get("url"))||["",null]),n[1]},colorLuminance:function(e,t){var n,i,r;for(e=String(e).replace(/[^0-9a-f]/g,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0,r="#",n=void 0,i=void 0,i=0;3>i;)n=parseInt(e.substr(2*i,2),16),n=Math.round(Math.min(Math.max(0,n+n*t),255)).toString(16),r+=("00"+n).substr(n.length),i++;return r}}),Ember.Application.initializer({name:"registerUtilities",initialize:function(e,t){t.register("utility:main",Ember.Utility)}}),Ember.Application.initializer({name:"injectUtilities",initialize:function(e,t){t.inject("controller","utility","utility:main"),t.inject("route","utility","utility:main"),t.inject("model","utility","utility:main"),t.inject("view","utility","utility:main")}})}.call(this),function(){Ember.I18n.translations={application:{title:"Strategiske Indsatsplan",navbar:{graph:"Oversigt",strategies:"Planer",administrations:"Forvaltninger",themes:"Indsatsplaner",settings:"Indstillinger",about:"Om"},footer:{organization:"Herning Kommune"}},index:{heading:"Oversigt",description:""},graph:{heading:"Oversigt",description:""},strategies:{index:{heading:"Indsatsplaner"}},administrations:{index:{heading:"Forvalninger",add:"Tilføj forvaltning",name:"Forvaltning",color:"Farve"},"new":{heading:"Opret nye forvaltning",name:"Navn",color:"Farve",create:"Opret"},edit:{heading:"Redigere forvaltningen",name:"Navn",color:"Farve",update:"Opdatere","delete":"Slet",cancel:"Annullere",modal:{info:"Er du sikker at du vil gerne slette forvaltning"}}},themes:{index:{heading:"Temaer",add:"Tilføj tema",definition:"Beskrivelse"},"new":{heading:"Opret nye tema",definition:"Beksrivelse",create:"Opret"},edit:{heading:"Redigere tema",name:"Beskrivelse",update:"Opdatere","delete":"Slet",cancel:"Annullere",modal:{info:"Er du sikker at du vil gerne denne slette tema"}}},focusareas:{index:{heading:"Fokus områder",add:"Tilføj fokus område",definition:"Beskrivelse",theme:"Tema"},"new":{heading:"Opret nye fokus område",definition:"Beksrivelse",create:"Opret"},edit:{heading:"Redigere fokus område",name:"Beskrivelse",update:"Opdatere","delete":"Slet",cancel:"Annullere",modal:{info:"Er du sikker at du vil gerne slette denne fokus område"}}},notify:{danger:"Fejl",warning:"Bemærk",info:"Info",success:"Success"}}}.call(this),function(){Ember.Handlebars.helper("capitalize",function(e){return Ember.I18n.exists("notify."+e)?Ember.I18n.t("notify."+e):e.capitalize()}),Ember.MODEL_FACTORY_INJECTIONS=!0,window.App=Ember.Application.create({LOG_TRANSITIONS:!0,LOG_TRANSITIONS_INTERNAL:!0,LOG_VIEW_LOOKUPS:!0,LOG_BINDINGS:!0,LOG_ACTIVE_GENERATION:!0,LOG_DEBUG:!0,log:function(e,t,n){return this.LOG_DEBUG?null!=n?("object"==typeof n&&(n=Ember.inspect(n)),console.log("DEBUG: "+this.appName+" : "+t+" : "+e),console.log("DEBUG: (continued) data: "+n)):console.log("DEBUG: "+this.appName+" : "+t+" : "+e):void 0}}),App.ApplicationAdapter=DS.RESTAdapter.extend({namespace:"api",host:"http://127.0.0.1:4567",corsWithCredentials:!0}),window.App.ready=function(){return $(document).ajaxStart(function(){return NProgress.start()}),$(document).ajaxStop(function(){return NProgress.done()})}}.call(this),function(){var e;e=1500,App.AutosavableModel=Ember.Mixin.create({_buffers:function(){return Ember.Map.create()}.property()}),App.AutosavableController=Ember.Mixin.create({bufferedFields:[],instaSaveFields:[],_allFields:function(){return this.get("bufferedFields").concat(this.get("instaSaveFields"))}.property(),setUnknownProperty:function(e,t){return this.get("ready")?this.get("bufferedFields").contains(e)?(this.get("_buffers").set(e,t),this._debouncedSave()):this.get("instaSaveFields").contains(e)?(this._super(e,t),this._save()):this._super(e,t):void 0},unknownProperty:function(e){return this.get("ready")?this.get("_allFields").contains(e)&&this.get("_buffers").get(e)?this.get("_buffers").get(e):this._super(e):void 0},_save:function(){var e,t,n;return this.get("ready")?(n=this,e=this.get("content"),this.get("content.isSaving")?this._debouncedSave():(console.log("App.AutosavableController::_save: Saving Changes..."),NProgress.set(0).start(),this.get("_buffers").forEach(function(e,t){return n.get("content").set(e,t)}),this.set("_buffers",Ember.Map.create()),t=function(){NProgress.done()},e.on("didCreate",t),e.on("didUpdate",t),e.save())):void 0},_debouncedSave:function(t){this.get("ready")&&(console.log("App.AutosavableController::_debouncedSave: Save requestsed and scheduled: ",e),Ember.run.debounce(this,this._save,e,t))},_saveNowAndClear:function(){if(this.get("ready")){if(console.log("App.AutosavableController::_saveNowAndClear: clearing..."),!this.get("content")||this.get("content.isDeleted"))return;return this._save(),this.set("_buffers",Ember.Map.create())}}.observesBefore("content"),actions:{save:function(){this._save()}}})}.call(this),function(){App.XNotifyComponent=Ember.Component.extend({classNames:"notify-messages",messages:Ember.computed.alias("notify")}),App.XNotifyMessageComponent=Ember.Component.extend({classNames:["x-notify-message-container"],classNameBindings:["insertState"],insertState:"pre-insert",didInsertElement:function(){var e;e=this,e.$().bind("webkitTransitionEnd",function(){"destroyed"===e.get("insertState")&&e.notify.removeObject(e.get("message"))}),Ember.run.later(function(){e.set("insertState","inserted")},250),e.notify.timeout&&Ember.run.later(function(){e.set("insertState","destroyed")},e.notify.timeout)},willDestroyElement:function(){var e;e=this,e.set("insertState","destroyed")},click:function(){var e;e=this,e.set("insertState","destroyed")}})}.call(this),function(){App.XGraphComponent=Ember.View.extend({editing:!1,toggleEditing:function(){null!==this.graph&&this.graph.setOptions({dataManipulation:this.get("editing")})}.observes("editing"),data:null,graphDataSet:{nodes:new vis.DataSet,edges:new vis.DataSet},selected:"",graph:null,setup:function(){var e,t,n,i;i=this,e=$("<div>").appendTo(this.$())[0],t=this.get("graphDataSet"),n={configurePhysics:!1,navigation:!0,width:"100%",height:"600px",stabilize:!1,stabilizationIterations:1,dataManipulation:this.get("editing"),tooltip:{delay:300,fontColor:"black",fontSize:14,fontFace:"verdana",color:{border:"#666",background:"#FFFFC6"}}},this.graph=new vis.Network(e,t,n),this.graph.on("click",function(e){console.log("Graph click"),e.nodes.length>0&&i.set("selected",e.nodes[0])}),$(window).resize(function(){i.graph.redraw()})},dataUpdates:function(){var e,t,n,i,r;null===this.graph&&this.setup(),i=this.get("data"),e=this.get("graphDataSet"),null!=e&&null!=i&&(n=e.nodes.get({filter:function(e){var t;return t=!0,i.nodes.forEach(function(n){e.id===n.id&&(t=!1)}),t}}),e.nodes.remove(n),e.nodes.update(i.nodes),t=e.edges.get({filter:function(e){var t;return t=!0,i.edges.forEach(function(n){e.id===n.id&&(t=!1)}),t}}),e.edges.remove(t),r=i.edges.filter(function(t){return null!==e.nodes.get(t.from)&&null!==e.nodes.get(t.to)}),e.edges.update(r))}.observes("data").on("didInsertElement")})}.call(this),function(){App.ColorPicker=Ember.View.extend({didInsertElement:function(){return $("#color").colorpicker()}})}.call(this),function(){App.StrategyTabAnchorView=Ember.View.extend({tagName:"a",didInsertElement:function(){return this.$().attr("href","#/strategies/administration/"+this.get("administration_id"))}})}.call(this),function(){App.StrategyTabPaneView=Ember.View.extend({tagName:"div",classNames:["strategies-administrations-tab tab-pane"],classNameBindings:["isActive:active"],isActive:function(){return this.get("firstObject").get("id")===this.get("administration_id")}.property("controller.model")})}.call(this),function(){}.call(this),function(){}.call(this),function(){App.AdministrationSerializer=DS.ActiveModelSerializer.extend(DS.EmbeddedRecordsMixin).extend({attrs:{strategies:{serialize:"ids",deserialize:"ids"}}}),App.Administration=DS.Model.extend({name:DS.attr("string"),color:DS.attr("string"),strategies:DS.hasMany("strategy",{async:!0}),style:function(){return"background-color:"+this.get("color")+";width:200px;display: block; padding: 10px;margin-right: 150px;"}.property("color"),tabStyle:function(){return"background-color:"+this.get("color")+";width: 100%; height: 5px;"}.property("color"),shadedTabStyle:function(){return"background-color:"+this.utility.colorLuminance(this.get("color"),.4)+";width: 100%; height: 3px;"}.property("color"),hashedID:function(){return"#"+this.get("id")}.property("id")})}.call(this),function(){App.ThemeSerializer=DS.ActiveModelSerializer.extend(DS.EmbeddedRecordsMixin).extend({attrs:{focusareas:{serialize:"ids",deserialize:"ids"}}}),App.Theme=DS.Model.extend({definition:DS.attr("string"),focusareas:DS.hasMany("focusarea",{async:!0}),hashedID:function(){return"#"+this.get("id")}.property("id")})}.call(this),function(){App.FocusareaSerializer=DS.ActiveModelSerializer.extend(DS.EmbeddedRecordsMixin).extend({attrs:{strategies:{serialize:"ids",deserialize:"ids"}}}),App.Focusarea=DS.Model.extend({definition:DS.attr("string"),theme:DS.belongsTo("theme",{embedded:"always"}),strategies:DS.hasMany("strategy",{async:!0}),hashedID:function(){return"#"+this.get("id")}.property("id")})}.call(this),function(){App.Strategy=DS.Model.extend(App.AutosavableModel,{description:DS.attr("string"),selected:DS.attr("boolean"),administration:DS.belongsTo("administration",{embedded:!0}),focusarea:DS.belongsTo("focusarea",{embedded:!0})})}.call(this),function(){App.Router.map(function(){return this.resource("graph"),this.resource("administrations"),this.resource("administrations.new",{path:"/administrations/new"}),this.resource("administrations.edit",{path:"/administrations/edit/:administration_id"}),this.resource("themes",function(){return this.route("new"),this.route("edit",{path:"/edit/:theme_id"}),this.resource("focusareas",{path:"/:theme_id/focusareas"},function(){return this.route("new",{path:"/new"}),this.route("edit",{path:"/edit/:focusarea_id"})})}),this.resource("strategies",function(){return this.route("administration",{path:"/administration/:administration_id"})}),this.resource("about"),this.resource("settings")})}.call(this),function(){App.ApplicationRoute=Ember.Route.extend({actions:{loading:function(){return NProgress.start(),this.router.one("didTransition",function(){return setTimeout(function(){return NProgress.done()},50)}),!0},error:function(){return setTimeout(function(){return NProgress.done()},50)}}})}.call(this),function(){App.GraphRoute=Ember.Route.extend({model:function(){var e;return e=this.store.findAll("strategy")},setupController:function(e,t){var n;return n=t.filterProperty("selected",!0),e.set(t,n),e.get("nodes").clear(),this.loadNodes(e,n),e.get("edges").clear(),this.loadEdges(e,n)},loadNodes:function(e,t){var n;return n=this,t.forEach(function(t){var i;return i={},i.id=t.get("id"),i.description=t.get("description"),i.selected=t.get("selected"),n.store.find("administration",t.get("administration.id")).then(function(r){return i.group=r.get("name"),i.label=r.get("name"),i.color=r.get("color"),i["color.highlight"]=r.get("shadedTabStyle"),i.administration_id=r.get("id"),n.store.find("focusarea",t.get("focusarea.id")).then(function(r){return i.focusarea=r.get("definition"),i.focusarea_id=r.get("id"),n.store.find("theme",r.get("theme.id")).then(function(n){return i.title="<b><u>"+n.get("definition")+"</u></b><br><em>"+r.get("definition")+"</em><br>"+t.get("description"),i.theme=n.get("definition"),i.theme_id=n.get("id"),e.get("nodes").pushObject(i)})})})})},loadEdges:function(e){return this.store.find("focusarea").then(function(t){return t.forEach(function(t){return t.get("strategies").then(function(t){var n,i,r,o,s,a;if(console.log("Strategies:",t,"=",t.get("length")),null!=t&&t.get("length")>1){for(r=t.toArray(),a=[],i=o=0,s=r.length-1;s>=o;i=o+=1)i>0&&i<r.length?(n={},n.to=r[i-1].get("id"),n.from=r[i].get("id"),console.log("Edge(",i,"):",n),a.push(e.get("edges").pushObject(n))):a.push(void 0);return a}})})})}})}.call(this),function(){App.AdministrationsRoute=Ember.Route.extend({model:function(){return this.store.find("administration")}}),App.AdministrationsNewRoute=Ember.Route.extend({model:function(){return this.store.createRecord("administration")}}),App.AdministrationsEditRoute=Ember.Route.extend({model:function(){return this.modelFor("administration")}})}.call(this),function(){App.ThemesIndexRoute=Ember.Route.extend({model:function(e){return App.log("Loading the model for theme","App.ThemesIndexRoute.model",e),this.store.find("theme")},afterModel:function(e){var t,n;if(0===e.get("length"))return this.transitionTo("/themes/new");n=this.utility.idFromURL(window.location.href);try{return this.transitionTo(null!=n?"/themes/"+n+"/focusareas":"/themes/"+e.get("firstObject").get("id")+"/focusareas")}catch(i){return t=i,this.transitionTo("/themes/"+e.get("firstObject").get("id")+"/focusareas")}}}),App.ThemesRoute=Ember.Route.extend({model:function(){return App.log("Loading the model for theme","App.ThemesRoute.model"),this.store.find("theme")},afterModel:function(e){var t;return console.log("AFTER MODEL - ThemesRoute",window.location.href),t=this.utility.idFromURL(window.location.href),this.transitionTo(null!=t?"/themes/"+t+"/focusareas":null!=e.get("firstObject")?"/themes/"+e.get("firstObject").get("id")+"/focusareas":"/themes/new")}}),App.ThemesNewRoute=Ember.Route.extend({model:function(){return App.log("Loading the model for theme","App.ThemesNewRoute.model"),this.store.createRecord("theme")}}),App.ThemesEditRoute=Ember.Route.extend({model:function(e){return App.log("Loading the model for theme","App.ThemesEditRoute.model",e),this.modelFor("theme",e)},setupController:function(e,t){var n;return this._super(e,t),n=this.store.find("focusarea",{theme:t.id}),n.then(function(){return App.log("Setting up the controller for edit theme","App.ThemesEditRoute.setupController",n),e.set("focusareasLength",n.get("length"))})}})}.call(this),function(){App.FocusareasRoute=Ember.Route.extend({model:function(e){return this.store.filter("focusarea",{},function(t){return t.get("data.theme.id")===e.theme_id?!0:void 0})}}),App.FocusareasNewRoute=Ember.Route.extend({model:function(){var e;return e=this.store.createRecord("focusarea")}}),App.FocusareasEditRoute=Ember.Route.extend({model:function(){return this.modelFor("focusarea")}})}.call(this),function(){App.StrategiesRoute=Ember.Route.extend({model:function(){return this.store.findAll("administration")},afterModel:function(e){var t;return 0!==e.get("length")?(t=e.get("firstObject").get("id"),this.transitionTo("/strategies/administration/"+t)):this.transitionTo("/administrations/new")}})}.call(this),function(){App.StrategiesAdministrationRoute=Ember.Route.extend({model:function(e){return Ember.Object.create({administration:this.store.find("administration",e.administration_id),themes:this.store.findAll("theme")})},setupController:function(e,t){return console.log("LOADED"),e.set("administration",t.administration),e.set("themes",t.themes)}})}.call(this),function(){App.AdministrationsController=Ember.ArrayController.extend({administrationsCount:function(){var e;return e=this.get("model.length"),e?e:0}.property("@each")})}.call(this),function(){App.AdministrationsNewController=Ember.ObjectController.extend({actions:{submit:function(){var e,t,n;return e=this.get("model"),n=!0,Ember.isEmpty(e.get("name"))&&(this.notify.danger("Name cannot be empty."),n=!1),t=0,this.store.all("administration").forEach(function(n){return n.get("name")===e.get("name")?t+=1:void 0}),t>1&&(this.notify.danger(e.get("name")+" is already used."),n=!1),Ember.isEmpty(e.get("color"))&&(this.notify.danger("Color cannot be empty."),n=!1),n?e.save().then(function(){return this.transitionToRoute("/administrations")}):void 0},cancel:function(){return this.transitionToRoute("/administrations")}}})}.call(this),function(){App.AdministrationsEditController=Ember.ObjectController.extend({actions:{update:function(){var e,t,n;return e=this.get("model"),n=!0,Ember.isEmpty(e.get("name"))&&(this.notify.danger("Name cannot be empty."),n=!1),t=0,this.store.all("administration").forEach(function(n){return n.get("name")===e.get("name")?t+=1:void 0}),t>1&&(this.notify.danger(e.get("name")+" is already used."),n=!1),Ember.isEmpty(e.get("color"))&&(this.notify.danger("Color cannot be empty."),n=!1),n?e.save().then(function(){return this.transitionToRoute("/administrations")}):void 0},"delete":function(){var e,t;return t=this,e=this.get("model"),console.log("delete administration"),e.destroyRecord().then(function(){return t.transitionToRoute("/administrations")})},cancel:function(){return this.transitionToRoute("/administrations")}}})}.call(this),function(){}.call(this),function(){App.ThemesNewController=Ember.ObjectController.extend({actions:{submit:function(){var e,t,n;return n=this.get("model"),t=!0,Ember.isEmpty(n.get("definition"))&&(this.notify.danger("Definition cannot be empty."),t=!1),t?(e=this,n.save().then(function(t){return App.log("Saving the theme and transitioning to the theme's focusareas","App.ThemesNewController.submit",t.get("id")),e.transitionToRoute("/themes/"+n.get("id")+"/focusareas")})):this.transitionToRoute("/themes/new")},cancel:function(){return this.get("model").rollback(),this.transitionToRoute("/themes")}}})}.call(this),function(){App.ThemesEditController=Ember.ObjectController.extend({actions:{update:function(){var e,t;return t=this.get("model"),e=!0,Ember.isEmpty(t.get("definition"))&&(this.notify.danger("Definition cannot be empty."),e=!1),e?(t.save(),this.transitionToRoute("/themes/"+t.get("id")+"/focusareas")):this.transitionToRoute("/themes/edit")},"delete":function(){var e,t;return t=this.get("model"),e=this,t.get("focusareas").then(function(n){return 0===n.get("length")?t.destroyRecord().then(function(){return e.transitionToRoute("/themes")}):(e.notify.danger("Cannot delete "+t.get("definition")+". Please delete all the focus areas related to this theme first."),e.transitionToRoute("/themes/"+t.get("id")+"/focusareas"))})},cancel:function(){return this.get("model").rollback(),this.transitionToRoute("/themes/"+this.get("model").get("id")+"/focusareas")}}})}.call(this),function(){App.FocusareasController=Ember.ArrayController.extend()}.call(this),function(){App.FocusareasNewController=Ember.ObjectController.extend({actions:{submit:function(){var e,t,n,i;return e=this.get("model"),n=!0,i=this.utility.idFromURL(window.location.href),Ember.isEmpty(e.get("definition"))&&(this.notify.danger("Definition cannot be empty."),n=!1),n?(t=this,this.store.find("theme",i).then(function(n){return e.set("theme",n),e.save().then(function(){return n.get("focusareas").pushObject(e),n.save().then(function(){return t.transitionToRoute("/themes/"+i+"/focusareas")})})})):this.transitionToRoute("/themes/"+i+"/focusareas/new")},cancel:function(){return this.transitionToRoute("/themes/"+this.utility.idFromURL(window.location.href)+"/focusareas")}}})}.call(this),function(){App.FocusareasEditController=Ember.ObjectController.extend({actions:{update:function(){var e,t,n,i;return e=this.get("model"),n=!0,i=this.utility.idFromURL(window.location.href),Ember.isEmpty(e.get("definition"))&&(this.notify.danger("Definition cannot be empty."),n=!1),null==i&&(this.notify.danger("You have to create themes before creating focus areas!"),n=!1),n?(t=this,e.save().then(function(){return t.transitionToRoute("/themes/"+i+"/focusareas")})):this.transitionToRoute("/themes/"+i+"/focusareas/edit")},"delete":function(){var e,t,n;return t=this,e=this.get("model"),n=e.get("theme"),n.get("focusareas").removeObject(e),n.save().then(function(){return e.destroyRecord().then(function(){return t.transitionToRoute("/themes/"+t.utility.idFromURL(window.location.href)+"/focusareas")})})},cancel:function(){return this.get("model").rollback(),this.transitionToRoute("/themes/"+this.utility.idFromURL(window.location.href)+"/focusareas")}}})}.call(this),function(){App.StrategiesController=Ember.ArrayController.extend()}.call(this),function(){App.StrategiesAdministrationController=Ember.ArrayController.extend({needs:"strategies",strategies:Ember.computed.alias("controllers.strategies")})}.call(this),function(){App.AdministrationStrategyController=Ember.ObjectController.extend(App.AutosavableController,{needs:"strategiesAdministration",strategiesAdministration:Ember.computed.alias("controllers.strategiesAdministration"),bufferedFields:["description"],instaSaveFields:["selected"],ready:!1,init:function(){var e,t,n;return t=this.get("model"),e=this.get("strategiesAdministration.administration"),n=this,this.store.find("strategy",{focusarea:t.get("id"),administration:e.get("id")}).then(function(i){var r;try{return console.log("FOUND:",i.get("length")),n.set("_buffers",Ember.Map.create()),0===i.get("length")?(console.log("CREATING..."),e.then(function(e){var i;return i=n.store.createRecord("strategy",{isSelected:!1,administration:e,focusarea:t}),console.log("SAVING..."),i.save()})):(n.set("model",i.get("firstObject")),n.set("ready",!0),n._super())}catch(o){return r=o,console.error(r),n._super()}})}})}.call(this),function(){App.GraphController=Ember.ArrayController.extend({nodes:[],edges:[],dataSet:function(){var e;return e={nodes:this.get("nodes"),edges:this.get("edges")}}.property("nodes.@each","edges.@each"),init:function(){return this.set("nodes",[]),this.set("edges",[])},selectedStrategiesCount:function(){return this.get("model").get("length")}.property("strategies.@each.strategy")})}.call(this);
//# sourceMappingURL=app-compiled.min.map